name: CI/CD on EC2

on: 
    push:
        branches:
            - main
            - whatsapp-config

jobs:
    deploy:
        runs-on: self-hosted

        steps:
            - name: Checkout Code
              uses: actions/checkout@v4.2.2
            
            - name: Build Docker Image
              run: |
                cd ~/app
                echo `pwd`
                docker build -t autobiz .
            
            - name: Stop and Remove Old Container
              run: |
                docker stop fastapi-container || true
                docker rm fastapi-container || true
          
            - name: Start New Container
              run: |
                docker run -d --name fastapi-container -p 5000:5000 autobiz
